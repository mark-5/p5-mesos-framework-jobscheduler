#!/usr/bin/env perl
use strict;
use warnings;
use Getopt::Long::Descriptive;
use Mesos::JobScheduler;
use Mesos::SchedulerDriver;

# PODNAME: start-server

my ($opt, $usage) = describe_options(
    "$0 %o",
    ['listen|l=s', 'the address to listen to http requests on'],
    ['master|m=s', 'the mesos master to use', {required => 1}],
);
my ($host, $port) = split ':', $opt->{listen} // '';
$host ||= '0.0.0.0';
$port ||= 8080;

my $scheduler = Mesos::JobScheduler->new(
    http => {
        host => $host || '0.0.0.0',
        port => $port || 8080,
    },
);

my $driver = Mesos::SchedulerDriver->new(
    dispatcher => 'AnyEvent',
    framework  => {
        user => $ENV{USER},
        name => 'Mesos::JobScheduler Framework',
    },
    master    => $opt->{master},
    scheduler => $scheduler,
);

$SIG{INT} = sub { exit 0 };
$driver->run;
